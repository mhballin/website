---
import { CONTACT_EMAIL } from "../config";
const { sideBarActiveItemID } = Astro.props;
const activeClass = "bg-base-300"; // For primary color replace with `active` class
---

<ul class="menu grow shrink menu-md overflow-y-auto">
    <li><a class="py-3 text-base" id="home" href="/">Home</a></li>
    <li><a class="py-3 text-base" id="work" href="/work">Projects & Work</a></li>
    <li><a class="py-3 text-base" id="cv" href="/cv">CV</a></li>
    <li>
        <!--@email_off-->
        <div class="sidebar-contact-menu relative py-0">
            <button
                class="sidebar-contact-btn py-3 text-base w-full text-left"
                title="Contact"
                aria-label="Contact menu"
            >
                Contact
            </button>

            <!-- Dropdown menu -->
            <div class="sidebar-contact-dropdown hidden absolute bottom-full mb-2 left-0 bg-base-200 rounded-lg shadow-lg overflow-hidden min-w-max z-50">
                <!-- Email option -->
                <div class="border-b border-base-300 last:border-b-0">
                    <button
                        class="sidebar-contact-email-btn w-full px-4 py-3 hover:bg-base-300 transition-colors text-left flex items-center gap-3"
                        title="Email"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            style="fill: currentColor;"
                        >
                            <path d="M20 4H4c-1.103 0-2 .897-2 2v12c0 1.103.897 2 2 2h16c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2zm0 2v.511l-8 6.223-8-6.222V6h16zM4 18V9.044l7.386 5.745a.994.994 0 0 0 1.228 0L20 9.044 20.002 18H4z" />
                        </svg>
                        <div class="flex flex-col">
                            <span class="text-sm font-medium">Email</span>
                            <span class="text-xs text-gray-500" data-email-display></span>
                        </div>
                    </button>
                </div>

                <!-- LinkedIn option -->
                <a
                    href="https://www.linkedin.com/in/mike-ballin/"
                    target="_blank"
                    class="sidebar-contact-linkedin-btn w-full px-4 py-3 hover:bg-base-300 transition-colors text-left flex items-center gap-3 block"
                    title="LinkedIn"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        style="fill: currentColor;"
                    >
                        <circle cx="4.983" cy="5.009" r="2.188"></circle>
                        <path
                            d="M9.237 8.855v12.139h3.769v-6.003c0-1.584.298-3.118 2.262-3.118 1.937 0 1.961 1.811 1.961 3.218v5.904H21v-6.657c0-3.27-.704-5.783-4.526-5.783-1.835 0-3.065 1.007-3.568 1.96h-.051v-1.66H9.237zm-6.142 0H6.87v12.139H3.095z"
                        ></path>
                    </svg>
                    <div class="flex flex-col">
                        <span class="text-sm font-medium">LinkedIn</span>
                        <span class="text-xs text-gray-500">View Profile</span>
                    </div>
                </a>
            </div>
        </div>
        <!--@email_on-->
    </li>
</ul>

<script define:vars={{ sideBarActiveItemID: sideBarActiveItemID, activeClass: activeClass, contactEmail: CONTACT_EMAIL }}>
const activeItemElem = document.getElementById(sideBarActiveItemID);
activeItemElem && activeItemElem.classList.add(activeClass);

// Contact menu functionality
const wrapper = document.querySelector('.sidebar-contact-menu');
const button = wrapper?.querySelector('.sidebar-contact-btn');
const dropdown = wrapper?.querySelector('.sidebar-contact-dropdown');
const emailBtn = wrapper?.querySelector('.sidebar-contact-email-btn');
const emailDisplay = wrapper?.querySelector('[data-email-display]');

const email = contactEmail;

// Set email display
if (emailDisplay) {
    emailDisplay.textContent = email;
}

// Toggle dropdown
button?.addEventListener('click', (e) => {
    e.stopPropagation();
    const isOpen = !dropdown?.classList.contains('hidden');
    if (isOpen) {
        dropdown?.classList.add('hidden');
    } else {
        dropdown?.classList.remove('hidden');
    }
});

// Handle email button click
const performCopy = async () => {
    try {
        await navigator.clipboard.writeText(email);
        const originalHTML = emailBtn?.innerHTML;
        if (emailBtn) {
            emailBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" style="fill: currentColor;"><path d="M10 15.586L6.707 12.293c-.391-.391-1.023-.391-1.414 0-.391.391-.391 1.023 0 1.414l4 4c.391.391 1.023.391 1.414 0l10-10c.391-.391.391-1.023 0-1.414-.391-.391-1.023-.391-1.414 0L10 15.586z"/></svg> <span>Copied!</span>';
            setTimeout(() => {
                emailBtn.innerHTML = originalHTML;
            }, 2000);
        }
    } catch (err) {
        console.error('Failed to copy email:', err);
    }
};

emailBtn?.addEventListener('click', (e) => {
    e.preventDefault();
    const isMobile = window.innerWidth < 768;
    if (isMobile) {
        performCopy();
    } else {
        window.location.href = `mailto:${email}`;
    }
    dropdown?.classList.add('hidden');
});

// Close dropdown when clicking outside
document.addEventListener('click', (e) => {
    if (!wrapper?.contains(e.target as Node)) {
        dropdown?.classList.add('hidden');
    }
});

// Close dropdown when clicking a link
wrapper?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
        dropdown?.classList.add('hidden');
    });
});
</script>
