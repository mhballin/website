---
import { CONTACT_EMAIL } from "../config";
const { sideBarActiveItemID } = Astro.props;
const activeClass = "bg-base-300 text-base-content"; // For primary color replace with `active` class
---

<ul class="menu grow shrink menu-md overflow-y-auto">
    <li><a class="py-3 px-3 text-base font-medium text-base-content/80 rounded-lg hover:bg-base-200 hover:text-base-content transition-colors" id="home" href="/">Home</a></li>
    <li><a class="py-3 px-3 text-base font-medium text-base-content/80 rounded-lg hover:bg-base-200 hover:text-base-content transition-colors" id="work" href="/work">Projects & Work</a></li>
    <li><a class="py-3 px-3 text-base font-medium text-base-content/80 rounded-lg hover:bg-base-200 hover:text-base-content transition-colors" id="cv" href="/cv">CV</a></li>
    <li>
        <!--@email_off-->
        <details class="sidebar-contact-menu relative py-0">
            <summary
                class="sidebar-contact-btn py-3 px-3 text-base w-full text-left list-none cursor-pointer flex items-center gap-3 rounded-lg hover:bg-base-200 transition-colors"
                title="Contact"
                aria-label="Contact menu"
            >
                Contact
            </summary>

            <div class="sidebar-contact-dropdown absolute top-full mt-2 left-0 bg-base-200 rounded-lg shadow-lg overflow-hidden min-w-max z-50">
                <button
                    type="button"
                    class="w-full px-4 py-3 hover:bg-base-300 transition-colors text-left flex items-center gap-3 block border-b border-base-300 last:border-b-0"
                    data-copy-email={CONTACT_EMAIL}
                    title="Copy email"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        style="fill: currentColor;"
                    >
                        <path d="M20 4H4c-1.103 0-2 .897-2 2v12c0 1.103.897 2 2 2h16c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2zm0 2v.511l-8 6.223-8-6.222V6h16zM4 18V9.044l7.386 5.745a.994.994 0 0 0 1.228 0L20 9.044 20.002 18H4z" />
                    </svg>
                    <div class="flex flex-col">
                        <span class="text-sm font-medium">Email</span>
                        <span class="text-xs text-gray-500">{CONTACT_EMAIL}</span>
                    </div>
                    <span
                        class="ml-auto inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs text-gray-600"
                        aria-label="Copy email"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="14"
                            height="14"
                            viewBox="0 0 24 24"
                            style="fill: currentColor;"
                        >
                            <title>Copy to clipboard icon</title>
                            <path d="M16 1H4c-1.103 0-2 .897-2 2v14h2V3h12V1zm3 4H8c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h11c1.103 0 2-.897 2-2V7c0-1.103-.897-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                        <span data-copy-label>Copy</span>
                    </span>
                </button>

                <a
                    href="https://www.linkedin.com/in/mike-ballin/"
                    target="_blank"
                    class="w-full px-4 py-3 hover:bg-base-300 transition-colors text-left flex items-center gap-3 block"
                    title="LinkedIn"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        style="fill: currentColor;"
                    >
                        <circle cx="4.983" cy="5.009" r="2.188"></circle>
                        <path
                            d="M9.237 8.855v12.139h3.769v-6.003c0-1.584.298-3.118 2.262-3.118 1.937 0 1.961 1.811 1.961 3.218v5.904H21v-6.657c0-3.27-.704-5.783-4.526-5.783-1.835 0-3.065 1.007-3.568 1.96h-.051v-1.66H9.237zm-6.142 0H6.87v12.139H3.095z"
                        ></path>
                    </svg>
                    <div class="flex flex-col">
                        <span class="text-sm font-medium">LinkedIn</span>
                        <span class="text-xs text-gray-500">View Profile</span>
                    </div>
                </a>
            </div>
        </details>
        <!--@email_on-->
    </li>
</ul>

<script define:vars={{ sideBarActiveItemID: sideBarActiveItemID, activeClass: activeClass }}>
const activeItemElem = document.getElementById(sideBarActiveItemID);
if (activeItemElem) {
    activeItemElem.classList.add(activeClass);
}
</script>

<script is:inline>
document.addEventListener('click', async (event) => {
    const target = event.target instanceof Element
        ? event.target.closest('[data-copy-email]')
        : null;

    if (!target) return;

    const email = target.getAttribute('data-copy-email');
    if (!email) return;

    try {
        await navigator.clipboard.writeText(email);
        const label = target.querySelector('[data-copy-label]');
        if (label) {
            const original = label.textContent;
            label.textContent = 'Copied';
            setTimeout(() => {
                label.textContent = original ?? 'Copy';
            }, 1500);
        }
    } catch {
        // no-op
    }
});

// Close details when clicking outside
document.addEventListener('click', (event) => {
    const details = document.querySelector('.sidebar-contact-menu');
    const target = event.target instanceof Element ? event.target : null;
    
    if (details && !details.contains(target)) {
        details.open = false;
    }
});
</script>
