---
import BaseLayout from "../../layouts/BaseLayout.astro";
import ProjectGrid from "../../components/ProjectGrid.astro";
import { projects, type ProjectCategory } from "../../data/projects";
import Breadcrumb from "../../components/Breadcrumb.astro";

export function getStaticPaths() {
  const categories: ProjectCategory[] = ["blueprint", "making", "creative"];
  return categories.map((category) => ({
    params: { category },
    props: { category },
  }));
}

interface Props {
  category: ProjectCategory;
}

const { category } = Astro.props;
const categoryProjects = projects.filter((p) => p.category === category);

// If this category has only one project, redirect to its project page (301)
if (categoryProjects.length === 1) {
  const project = categoryProjects[0];
  const idOrSlug = project.slug ?? project.id;
  return Astro.redirect(`/work/${category}/${idOrSlug}`, 301);
}

const categoryLabels: Record<ProjectCategory, { name: string; description: string }> = {
  blueprint: {
    name: "Blueprint",
    description: "Startup & professional projects involving product development and innovation.",
  },
  making: {
    name: "Making",
    description: "Personal builds, prototypes, and experimental projects exploring new materials and techniques.",
  },
  creative: {
    name: "Creative",
    description: "Design and visual work including photography, web design, and artistic projects.",
  },
};

const categoryInfo = categoryLabels[category];
---

<BaseLayout title={`Work - ${categoryInfo.name}`} sideBarActiveItemID="work">
  <Breadcrumb
    items={[
      { href: "/work", label: "Work" },
      { label: categoryInfo.name }
    ]}
  />

  <div class="pb-8">
    <div class="text-3xl w-full font-bold mb-2">{categoryInfo.name}</div>
    <div class="text-lg text-gray-600 mb-5">{categoryInfo.description}</div>
  </div>

  <ProjectGrid projects={categoryProjects} category={category} />
</BaseLayout>
